# 产品需求文档：人与机器抢答功能

## 1. 概述

### 1.1 问题陈述
当前 KET 备考系统缺乏趣味性和竞争性，学生在长时间练习中容易感到枯燥，学习动力不足。需要一种更有趣的学习模式来提升学生的参与度和学习效果。

### 1.2 解决方案
引入"人与机器抢答"游戏模式，让学生与 AI 机器人进行实时答题竞赛。通过竞争机制激发学习兴趣，通过即时反馈强化学习效果。

### 1.3 成功指标
- 抢答模式日活跃用户占比 > 30%
- 抢答模式平均每日使用时长 > 15 分钟
- 用户满意度评分 > 4.5/5
- 抢答模式下的答题正确率提升 > 10%

## 2. 用户故事

### US-1: 进入抢答模式
作为学生用户，我想选择进入抢答模式，以便与 AI 机器人进行答题竞赛。

**验收标准**：
- 在主页面有明显的"抢答模式"入口
- 点击后进入抢答准备页面
- 显示抢答规则说明

### US-2: 实时竞赛答题
作为学生用户，我想与 AI 机器人同时答题，以便体验竞争的乐趣。

**验收标准**：
- 题目同时展示给学生和 AI
- 显示双方答题进度
- 实时显示谁先提交答案
- AI 答题速度符合真实学生水平

### US-3: 查看竞赛结果
作为学生用户，我想看到每道题的竞赛结果，以便了解自己的表现。

**验收标准**：
- 显示双方答案和正确性
- 显示答题用时对比
- 显示本轮胜负结果
- 胜利时播放奖励动画

### US-4: 查看抢答战绩
作为学生用户，我想在个人主页查看抢答战绩，以便追踪自己的进步。

**验收标准**：
- 显示总场次、胜场、败场
- 显示胜率统计
- 显示最快答题记录
- 显示连胜记录

## 3. 功能需求

### 3.1 抢答模式入口
- **FR-001**: 在主页面添加"抢答模式"按钮
- **FR-002**: 显示抢答模式规则说明弹窗
- **FR-003**: 支持选择题目难度（1-5 级）
- **FR-004**: 支持选择题目模块（词汇/语法/阅读）
- **FR-005**: 支持选择抢答轮数（5/10/20 题）

### 3.2 抢答游戏界面
- **FR-006**: 显示当前题目信息（题号、难度、模块）
- **FR-007**: 显示倒计时（每题 30 秒）
- **FR-008**: 显示学生和 AI 的答题状态（未答/已答）
- **FR-009**: 显示双方答题用时
- **FR-010**: 支持学生选择答案并提交
- **FR-011**: 提交后立即显示结果对比

### 3.3 AI 机器人行为
- **FR-012**: AI 根据题目难度调整答题时间
  - 难度 1-2: 5-10 秒
  - 难度 3: 8-15 秒
  - 难度 4-5: 12-20 秒
- **FR-013**: AI 答题正确率根据难度调整
  - 难度 1-2: 85-95%
  - 难度 3: 75-85%
  - 难度 4-5: 60-75%
- **FR-014**: AI 答题时间随机波动 ±20%
- **FR-015**: AI 显示"思考中"动画

### 3.4 竞赛反馈
- **FR-016**: 显示每题结果（双方答案、正确性、用时）
- **FR-017**: 显示本轮得分（学生 vs AI）
- **FR-018**: 学生获胜时播放庆祝动画
- **FR-019**: 显示鼓励语（根据胜负和表现）
- **FR-020**: 支持继续下一题或结束抢答

### 3.5 数据记录与展示
- **FR-021**: 记录每场抢答的详细数据
- **FR-022**: 在个人主页显示抢答战绩卡片
- **FR-023**: 显示总场次、胜场、败场、胜率
- **FR-024**: 显示最快答题记录
- **FR-025**: 显示最长连胜记录
- **FR-026**: 支持查看历史抢答记录

## 4. 非功能需求

### 4.1 性能要求
- **NFR-001**: 题目加载时间 < 500ms
- **NFR-002**: 答案提交响应时间 < 200ms
- **NFR-003**: AI 答题延迟模拟精确到 100ms
- **NFR-004**: 支持 100+ 并发用户

### 4.2 用户体验
- **NFR-005**: 界面响应流畅，无卡顿
- **NFR-006**: 动画效果自然，不影响答题
- **NFR-007**: 移动端适配良好
- **NFR-008**: 支持键盘快捷键（A/B/C/D）

### 4.3 安全性
- **NFR-009**: 防止客户端作弊（时间篡改）
- **NFR-010**: 答案在提交前不暴露给客户端
- **NFR-011**: 抢答记录数据完整性校验

### 4.4 可维护性
- **NFR-012**: AI 行为参数可配置
- **NFR-013**: 代码模块化，易于扩展
- **NFR-014**: 完整的单元测试和集成测试

## 5. 验收标准

### 5.1 功能验收
- [ ] 学生可以成功进入抢答模式
- [ ] 学生可以选择难度、模块、轮数
- [ ] 题目正确显示，选项可点击
- [ ] AI 机器人按预期时间答题
- [ ] AI 机器人正确率符合设定范围
- [ ] 答题结果正确显示（双方答案、用时）
- [ ] 胜负判定正确
- [ ] 胜利动画正常播放
- [ ] 抢答战绩正确记录和显示
- [ ] 个人主页正确展示抢答数据

### 5.2 性能验收
- [ ] 题目加载时间 < 500ms
- [ ] 答案提交响应时间 < 200ms
- [ ] 100 并发用户无性能问题

### 5.3 兼容性验收
- [ ] Chrome/Firefox/Safari 浏览器正常运行
- [ ] 移动端（iOS/Android）正常运行
- [ ] 不同屏幕尺寸适配良好

## 6. 技术考虑

### 6.1 数据库变更
需要新增以下数据表：

**speed_quiz_battles** (抢答对战记录)
- id: 主键
- user_id: 用户 ID
- difficulty: 难度
- module: 模块
- total_questions: 总题数
- user_correct: 用户答对数
- ai_correct: AI 答对数
- user_wins: 用户获胜题数
- ai_wins: AI 获胜题数
- created_at: 创建时间

**speed_quiz_details** (抢答详细记录)
- id: 主键
- battle_id: 对战 ID
- question_id: 题目 ID
- user_answer: 用户答案
- user_time: 用户用时（毫秒）
- ai_answer: AI 答案
- ai_time: AI 用时（毫秒）
- correct_answer: 正确答案
- winner: 获胜方（user/ai/tie）
- created_at: 创建时间

### 6.2 API 端点需求

**POST /api/speed-quiz/start**
- 请求：{ difficulty, module, rounds }
- 响应：{ battle_id, first_question }

**POST /api/speed-quiz/submit**
- 请求：{ battle_id, question_id, answer, answer_time }
- 响应：{ is_correct, ai_answer, ai_time, winner, next_question }

**GET /api/speed-quiz/stats**
- 响应：{ total_battles, wins, losses, win_rate, fastest_time, max_streak }

**GET /api/speed-quiz/history**
- 响应：{ battles: [...] }

### 6.3 前端组件需求
- SpeedQuizEntry.vue: 抢答模式入口
- SpeedQuizGame.vue: 抢答游戏主界面
- SpeedQuizResult.vue: 单题结果展示
- SpeedQuizStats.vue: 抢答战绩展示
- AIRobotAvatar.vue: AI 机器人头像和状态

### 6.4 技术栈
- 前端：Vue 3 + TypeScript + Tailwind CSS + Pinia
- 后端：Python FastAPI + SQLAlchemy + SQLite
- 测试：Vitest (前端) + Pytest (后端)

### 6.5 第三方依赖
- 无新增第三方依赖

## 7. 里程碑

### Phase 1: 核心功能（3 天）
- 数据库设计和迁移
- 后端 API 实现
- 前端基础界面

### Phase 2: AI 行为和动画（2 天）
- AI 答题逻辑
- 动画效果
- 结果展示

### Phase 3: 数据统计和优化（2 天）
- 战绩统计
- 性能优化
- 测试和修复

## 8. 风险和依赖

### 8.1 风险
- AI 答题速度和正确率平衡难以调优
- 动画效果可能影响性能
- 移动端体验可能不如桌面端

### 8.2 缓解措施
- AI 参数可配置，支持 A/B 测试
- 动画使用 CSS 硬件加速
- 优先保证移动端核心功能

### 8.3 依赖
- 依赖现有题库数据
- 依赖现有用户认证系统
