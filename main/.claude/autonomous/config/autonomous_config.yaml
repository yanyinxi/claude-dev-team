# Autonomous Evolution System Configuration
# 自主进化系统配置

# =====================================================
# Task Generation Configuration
# 任务生成配置
# =====================================================

task_generation:
  # Time-Based Triggers (Cron)
  time_based:
    enabled: true
    schedules:
      - name: "daily_health_check"
        cron: "0 9 * * *"  # 每天早上9点
        description: "每日系统健康检查"
        priority: 5

      - name: "weekly_optimization_review"
        cron: "0 10 * * 1"  # 每周一上午10点
        description: "每周优化审查"
        priority: 7

      - name: "monthly_architecture_review"
        cron: "0 14 1 * *"  # 每月1号下午2点
        description: "每月架构审查"
        priority: 8

  # Event-Based Triggers (Git Hooks)
  event_based:
    enabled: true
    triggers:
      - name: "post_commit_analysis"
        event: "post-commit"
        description: "提交后代码分析"
        priority: 6

      - name: "pre_push_validation"
        event: "pre-push"
        description: "推送前验证"
        priority: 8

      - name: "deployment_trigger"
        event: "deployment"
        description: "部署触发器"
        priority: 9

  # Metric-Based Triggers (Thresholds)
  metric_based:
    enabled: true
    thresholds:
      - name: "high_error_rate"
        metric: "error_rate"
        threshold: 0.05  # 5%
        operator: ">"
        description: "错误率过高"
        priority: 9

      - name: "slow_response_time"
        metric: "response_time_ms"
        threshold: 500
        operator: ">"
        description: "响应时间过慢"
        priority: 7

      - name: "low_test_coverage"
        metric: "test_coverage"
        threshold: 0.7  # 70%
        operator: "<"
        description: "测试覆盖率过低"
        priority: 6

  # LLM-Driven Triggers (Intelligent Analysis)
  llm_driven:
    enabled: true
    analysis_frequency: "daily"  # daily, weekly, on-demand
    model: "claude-sonnet-4-5"
    triggers:
      - name: "gap_analysis"
        description: "差距分析：当前状态 vs 理想状态"
        priority: 7

      - name: "pattern_recognition"
        description: "模式识别：发现重复问题"
        priority: 6

      - name: "improvement_opportunities"
        description: "改进机会识别"
        priority: 5

# =====================================================
# Self-Diagnosis Configuration
# 自我诊断配置
# =====================================================

diagnosis:
  # Health Monitoring
  health_monitoring:
    enabled: true
    check_interval_minutes: 60
    metrics:
      - "system_uptime"
      - "error_rate"
      - "response_time"
      - "test_coverage"
      - "code_quality_score"
      - "intelligence_score"

  # Gap Analysis
  gap_analysis:
    enabled: true
    llm_model: "claude-sonnet-4-5"
    analysis_depth: "comprehensive"  # basic, moderate, comprehensive
    comparison_targets:
      - "project_standards.md"
      - "best_practices"
      - "industry_benchmarks"

# =====================================================
# Scheduler Configuration
# 调度器配置
# =====================================================

scheduler:
  # Priority Queue
  priority_queue:
    max_queue_size: 100
    priority_formula: "base_priority * urgency_multiplier * resource_availability"

  # Resource Management
  resource_management:
    max_concurrent_tasks: 3
    max_tasks_per_hour: 5
    max_tasks_per_day: 20

  # Conflict Detection
  conflict_detection:
    enabled: true
    check_file_conflicts: true
    check_dependency_conflicts: true

# =====================================================
# Safety & Governance Configuration
# 安全与治理配置
# =====================================================

safety:
  # Approval Gates
  approval_gates:
    enabled: true
    require_approval_for:
      - "high_risk_operations"
      - "production_changes"
      - "database_modifications"
      - "security_changes"

    critical_keywords:
      - "delete"
      - "drop"
      - "remove"
      - "production"
      - "database"
      - "security"
      - "credentials"

  # Rollback Mechanisms
  rollback:
    enabled: true
    create_checkpoint_before_execution: true
    auto_rollback_on_failure: true
    keep_checkpoints_days: 30

  # Rate Limiting
  rate_limiting:
    enabled: true
    max_tasks_per_hour: 5
    max_tasks_per_day: 20
    max_concurrent_tasks: 3

  # Audit Logging
  audit_logging:
    enabled: true
    log_level: "INFO"
    log_file: ".claude/autonomous/logs/audit.log"
    log_rotation: "daily"
    keep_logs_days: 90

# =====================================================
# Database Configuration
# 数据库配置
# =====================================================

database:
  type: "sqlite"
  path: ".claude/autonomous/database/autonomous.db"
  backup_enabled: true
  backup_frequency: "daily"
  backup_retention_days: 30

# =====================================================
# Monitoring & Alerting Configuration
# 监控与告警配置
# =====================================================

monitoring:
  enabled: true
  dashboard_enabled: true
  metrics_retention_days: 90

  alerts:
    enabled: true
    channels:
      - "log"
      - "dashboard"

    alert_rules:
      - name: "high_failure_rate"
        condition: "failure_rate > 0.3"
        severity: "critical"

      - name: "queue_overflow"
        condition: "queue_size > 80"
        severity: "warning"

      - name: "rate_limit_exceeded"
        condition: "tasks_per_hour > 5"
        severity: "warning"

# =====================================================
# Evolution Strategy Configuration
# 进化策略配置
# =====================================================

evolution:
  # Learning Rate
  learning_rate: 0.1

  # Exploration vs Exploitation
  exploration_rate: 0.2  # 20% 探索新策略
  exploitation_rate: 0.8  # 80% 利用已知最佳策略

  # Strategy Update Frequency
  strategy_update_frequency: "weekly"

  # Knowledge Base Update
  knowledge_base_update: "continuous"
